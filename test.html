<!DOCTYPE html>
<html>
<head>
  <style>
    .flip-card {
      background-color: transparent;
      width: 100%;
      height: 0;
      padding-bottom: calc(100% / var(--nrows));
      perspective: 1000px;
      display: inline-block;
      margin: 10px;
    }

    .flip-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
    }

    .flip-card:hover .flip-card-inner {
      transform: rotateY(180deg);
    }

    .flip-card-front, .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }

    .flip-card-front {
      background-color: #bbb;
      color: black;
    }

    .flip-card-back {
      background-color: #2980b9;
      color: white;
      transform: rotateY(180deg);
    }

    .game-over-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .game-over-popup-inner {
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      text-align: center;
    }

    @media (max-width: 768px) {
      /* Adjust card size for smaller screens */
      .flip-card {
        padding-bottom: calc(100% / (var(--nrows) * 2));
      }
    }
  </style>
</head>
<body>
  <h2>Memory Game</h2>
  <label for="nrows">Number of Rows:</label>
  <input type="number" id="nrows" min="1" value="2">
  <label for="ncols">Number of Columns:</label>
  <input type="number" id="ncols" min="1" value="2">
  <button onclick="startGame()">Start Game</button>
  <div id="game-board"></div>
  <div id="game-over-popup" class="game-over-popup">
    <div class="game-over-popup-inner">
      <h3>Game Over!</h3>
      <p>Number of Rows: <span id="game-over-nrows"></span></p>
      <p>Number of Columns: <span id="game-over-ncols"></span></p>
      <button onclick="restartGame()">Restart Game</button>
    </div>
  </div>

  <script>
    var gameBoard = document.getElementById('game-board');
    var numRowsInput = document.getElementById('nrows');
    var numColsInput = document.getElementById('ncols');
    var gameOverPopup = document.getElementById('game-over-popup');
    var gameOverNRows = document.getElementById('game-over-nrows');
    var gameOverNCols = document.getElementById('game-over-ncols');
    var flippedCards = [];
    var matchedCards = [];
    var timer;

    function createCard(imageUrl) {
      var flipCard = document.createElement('div');
      flipCard.className = 'flip-card';

      var flipCardInner = document.createElement('div');
      flipCardInner.className = 'flip-card-inner';

      var flipCardFront = document.createElement('div');
      flipCardFront.className = 'flip-card-front';

      var flipCardBack = document.createElement('div');
      flipCardBack.className = 'flip-card-back';

      var cardImage = document.createElement('img');
      cardImage.src = imageUrl;
      cardImage.alt = 'Card Image';

      flipCardFront.appendChild(cardImage);
      flipCardInner.appendChild(flipCardFront);
      flipCardInner.appendChild(flipCardBack);
      flipCard.appendChild(flipCardInner);

      flipCard.addEventListener('click', function() {
        flipCardInner.style.transform = 'rotateY(180deg)';
        flippedCards.push(flipCardInner);

        if (flippedCards.length === 2) {
          if (flippedCards[0].innerHTML === flippedCards[1].innerHTML) {
            matchedCards.push(flippedCards[0], flippedCards[1]);
            flippedCards = [];

            if (matchedCards.length === numRowsInput.value * numColsInput.value) {
              clearTimeout(timer);
              showGameOverPopup();
            }
          } else {
            setTimeout(function() {
              flippedCards[0].style.transform = 'rotateY(0deg)';
              flippedCards[1].style.transform ='rotateY(0deg)';
              flippedCards = [];
            }, 1000);
          }
        }
      });

      return flipCard;
    }

    function startGame() {
      var numRows = parseInt(numRowsInput.value);
      var numCols = parseInt(numColsInput.value);

      gameBoard.innerHTML = '';
      gameBoard.style.setProperty('--nrows', numRows);
      gameBoard.style.gridTemplateColumns = 'repeat(' + numCols + ', 1fr)';

      for (var i = 0; i < numRows; i++) {
        for (var j = 0; j < numCols; j++) {
          var card = createCard('img_avatar.png');
          gameBoard.appendChild(card);
        }
      }

      flippedCards = [];
      matchedCards = [];

      timer = setTimeout(function() {
        showGameOverPopup();
      }, 60000);
    }

    function showGameOverPopup() {
      gameOverNRows.textContent = numRowsInput.value;
      gameOverNCols.textContent = numColsInput.value;
      gameOverPopup.style.display = 'flex';
    }

    function restartGame() {
      gameOverPopup.style.display = 'none';
      startGame();
    }
  </script>
</body>
</html>